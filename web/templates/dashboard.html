{% extends "base.html" %}

{% block title %}Dashboard - ShapeMateAI{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <!-- Welcome Section -->
        <div class="col-12">
            <div class="card bg-primary text-white mb-4">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h2 class="mb-2">
                                <i class="fas fa-hand-wave me-2"></i>
                                Olá, {{ user.name or 'Usuário' }}!
                            </h2>
                            <p class="mb-0 lead">Bem-vindo ao seu painel nutricional personalizado</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <i class="fas fa-user-circle fa-5x opacity-75"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Profile Summary -->
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-user me-2"></i>Perfil</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-2">
                        <div class="col-6"><strong>Idade:</strong></div>
                        <div class="col-6">{{ user.age or '-' }} anos</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6"><strong>Gênero:</strong></div>
                        <div class="col-6">{{ user.gender|title or '-' }}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6"><strong>Peso:</strong></div>
                        <div class="col-6">{{ user.weight or '-' }} kg</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6"><strong>Altura:</strong></div>
                        <div class="col-6">{{ user.height or '-' }} m</div>
                    </div>
                    {% if user.weight and user.height %}
                    <div class="row mb-2">
                        <div class="col-6"><strong>IMC:</strong></div>
                        <div class="col-6">
                            {% set imc = (user.weight / (user.height * user.height)) | round(1) %}
                            {{ imc }}
                            {% if imc < 18.5 %}
                                <span class="badge bg-warning">Abaixo</span>
                            {% elif imc < 25 %}
                                <span class="badge bg-success">Normal</span>
                            {% elif imc < 30 %}
                                <span class="badge bg-warning">Sobrepeso</span>
                            {% else %}
                                <span class="badge bg-danger">Obesidade</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Goals and Activity -->
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-target me-2"></i>Objetivos</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong>Objetivo Principal:</strong>
                        <p class="text-muted mb-0">{{ user.primary_goal|replace('_', ' ')|title or 'Não definido' }}</p>
                    </div>
                    <div class="mb-3">
                        <strong>Nível de Atividade:</strong>
                        <p class="text-muted mb-0">{{ user.activity_level|replace('_', ' ')|title or 'Não definido' }}</p>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="mt-4">
                        <h6>Ações Rápidas</h6>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary btn-sm" onclick="updateProfile()">
                                <i class="fas fa-edit me-2"></i>Editar Perfil
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="viewProgress()">
                                <i class="fas fa-chart-line me-2"></i>Ver Progresso
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Health Info -->
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-heart me-2"></i>Saúde</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong>Restrições Alimentares:</strong>
                        <p class="text-muted mb-0">
                            {{ user.dietary_restrictions or 'Nenhuma informada' }}
                        </p>
                    </div>
                    <div class="mb-3">
                        <strong>Condições de Saúde:</strong>
                        <p class="text-muted mb-0">
                            {{ user.health_conditions or 'Nenhuma informada' }}
                        </p>
                    </div>
                    {% if user.other_notes %}
                    <div class="mb-3">
                        <strong>Observações:</strong>
                        <p class="text-muted mb-0">{{ user.other_notes }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Main Actions -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-rocket me-2"></i>Começar Agora</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <!-- Nutricionista Virtual (Nutrion) -->
                        <div class="col-md-6 mb-4">
                            <div class="p-4 border rounded hover-card h-100" style="border-color: #28a745 !important; border-width: 2px !important;">
                                <div class="d-flex align-items-center justify-content-center mb-3">
                                    <i class="fas fa-user-md fa-3x me-3" style="color: #28a745;"></i>
                                    <div>
                                        <h4 class="mb-1" style="color: #28a745;">Nutrion</h4>
                                        <p class="text-muted small mb-0">Nutricionista Virtual</p>
                                    </div>
                                </div>
                                <p class="text-muted mb-3">
                                    <i class="fas fa-sparkles me-2" style="color: #28a745;"></i>
                                    Converse com nosso nutricionista IA alegre e motivador! Receba orientações personalizadas, 
                                    planos alimentares e acompanhamento profissional.
                                </p>
                                <div class="mb-3">
                                    <div class="row text-center">
                                        <div class="col-4">
                                            <i class="fas fa-apple-alt fa-lg mb-1" style="color: #28a745;"></i>
                                            <p class="small mb-0">Dietas</p>
                                        </div>
                                        <div class="col-4">
                                            <i class="fas fa-calculator fa-lg mb-1" style="color: #28a745;"></i>
                                            <p class="small mb-0">TMB</p>
                                        </div>
                                        <div class="col-4">
                                            <i class="fas fa-chart-pie fa-lg mb-1" style="color: #28a745;"></i>
                                            <p class="small mb-0">Análises</p>
                                        </div>
                                    </div>
                                </div>
                                <a href="{{ url_for('chat') }}" class="btn btn-success btn-lg w-100">
                                    <i class="fas fa-comments me-2"></i>Conversar com Nutrion
                                </a>
                            </div>
                        </div>
                        
                        <!-- Assistente do Dia-a-Dia -->
                        <div class="col-md-6 mb-4">
                            <div class="p-4 border rounded hover-card h-100" style="border-color: #20c997 !important; border-width: 2px !important;">
                                <div class="d-flex align-items-center justify-content-center mb-3">
                                    <i class="fas fa-robot fa-3x me-3" style="color: #20c997;"></i>
                                    <div>
                                        <h4 class="mb-1" style="color: #20c997;">Assistente</h4>
                                        <p class="text-muted small mb-0">Dia-a-Dia</p>
                                    </div>
                                </div>
                                <p class="text-muted mb-3">
                                    <i class="fas fa-magic me-2" style="color: #20c997;"></i>
                                    Seu parceiro diário para manter a dieta! Faça substituições inteligentes, 
                                    analise cardápios de restaurantes e receba listas de compras personalizadas.
                                </p>
                                <div class="mb-3">
                                    <div class="row text-center">
                                        <div class="col-4">
                                            <i class="fas fa-exchange-alt fa-lg mb-1" style="color: #20c997;"></i>
                                            <p class="small mb-0">Substituições</p>
                                        </div>
                                        <div class="col-4">
                                            <i class="fas fa-utensils fa-lg mb-1" style="color: #20c997;"></i>
                                            <p class="small mb-0">Cardápios</p>
                                        </div>
                                        <div class="col-4">
                                            <i class="fas fa-shopping-cart fa-lg mb-1" style="color: #20c997;"></i>
                                            <p class="small mb-0">Compras</p>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-info btn-lg w-100" onclick="startDailyAssistant()" style="background-color: #20c997; border-color: #20c997;">
                                    <i class="fas fa-hands-helping me-2"></i>Usar Assistente
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Tools Section -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-tools me-2"></i>Ferramentas Rápidas</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3 mb-3">
                            <div class="p-3 border rounded hover-card-small">
                                <i class="fas fa-utensils fa-2x text-success mb-2"></i>
                                <h6>Plano Alimentar</h6>
                                <p class="text-muted small">Solicite um novo plano personalizado</p>
                                <button class="btn btn-outline-success btn-sm" onclick="requestMealPlan()">
                                    Solicitar
                                </button>
                            </div>
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <div class="p-3 border rounded hover-card-small">
                                <i class="fas fa-chart-line fa-2x text-warning mb-2"></i>
                                <h6>Progresso</h6>
                                <p class="text-muted small">Acompanhe sua evolução</p>
                                <button class="btn btn-outline-warning btn-sm" onclick="trackProgress()">
                                    Ver Dados
                                </button>
                            </div>
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <div class="p-3 border rounded hover-card-small">
                                <i class="fas fa-camera fa-2x text-info mb-2"></i>
                                <h6>Foto da Refeição</h6>
                                <p class="text-muted small">Analise sua refeição</p>
                                <button class="btn btn-outline-info btn-sm" onclick="analyzeMeal()">
                                    Enviar Foto
                                </button>
                            </div>
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <div class="p-3 border rounded hover-card-small">
                                <i class="fas fa-edit fa-2x text-primary mb-2"></i>
                                <h6>Atualizar Perfil</h6>
                                <p class="text-muted small">Edite suas informações</p>
                                <button class="btn btn-outline-primary btn-sm" onclick="updateProfile()">
                                    Editar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity (Placeholder for future) -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-clock me-2"></i>Atividade Recente</h5>
                </div>
                <div class="card-body text-center py-5">
                    <i class="fas fa-history fa-3x text-muted mb-3"></i>
                    <h6 class="text-muted">Nenhuma atividade recente</h6>
                    <p class="text-muted">Comece a usar o ShapeMateAI para ver suas atividades aqui</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function updateProfile() {
    alert('Funcionalidade em desenvolvimento! Em breve você poderá editar seu perfil.');
}

function viewProgress() {
    alert('Funcionalidade em desenvolvimento! Em breve você poderá visualizar seu progresso.');
}

function requestMealPlan() {
    alert('Funcionalidade em desenvolvimento! Em breve você poderá solicitar planos alimentares personalizados.');
}

function trackProgress() {
    alert('Funcionalidade em desenvolvimento! Em breve você poderá acompanhar seu progresso detalhado.');
}

function startDailyAssistant() {
    // Mostrar modal com opções do assistente do dia-a-dia
    showDailyAssistantModal();
}

function analyzeMeal() {
    alert('Funcionalidade em desenvolvimento! Em breve você poderá enviar fotos das suas refeições para análise nutricional.');
}

function showDailyAssistantModal() {
    const modalHtml = `
        <div class="modal fade" id="dailyAssistantModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header" style="background-color: #20c997; color: white;">
                        <h5 class="modal-title">
                            <i class="fas fa-robot me-2"></i>Assistente do Dia-a-Dia
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4">
                        <p class="lead text-center mb-4">Como posso ajudar você hoje?</p>
                        
                        <div class="row text-center">
                            <div class="col-md-6 mb-3">
                                <div class="p-3 border rounded hover-card-small" onclick="handleSubstitution()">
                                    <i class="fas fa-exchange-alt fa-2x mb-2" style="color: #20c997;"></i>
                                    <h6>Substituições de Alimentos</h6>
                                    <p class="text-muted small">Precisa trocar um ingrediente? Vou verificar se é compatível com sua dieta!</p>
                                </div>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <div class="p-3 border rounded hover-card-small" onclick="analyzeMenu()">
                                    <i class="fas fa-utensils fa-2x mb-2" style="color: #20c997;"></i>
                                    <h6>Análise de Cardápios</h6>
                                    <p class="text-muted small">Vai sair para comer? Envie o cardápio e vou sugerir as melhores opções!</p>
                                </div>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <div class="p-3 border rounded hover-card-small" onclick="generateShoppingList()">
                                    <i class="fas fa-shopping-cart fa-2x mb-2" style="color: #20c997;"></i>
                                    <h6>Lista de Compras</h6>
                                    <p class="text-muted small">Vou criar uma lista personalizada baseada na sua dieta!</p>
                                </div>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <div class="p-3 border rounded hover-card-small" onclick="findRecipes()">
                                    <i class="fas fa-book fa-2x mb-2" style="color: #20c997;"></i>
                                    <h6>Receitas Personalizadas</h6>
                                    <p class="text-muted small">Busque receitas que se encaixam perfeitamente na sua dieta!</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-4">
                            <p class="text-muted small">
                                <i class="fas fa-info-circle me-2"></i>
                                Todas as sugestões são baseadas no seu perfil nutricional e objetivos pessoais.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remove modal if exists
    const existingModal = document.getElementById('dailyAssistantModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Add modal to body
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // Show modal
    const modal = new bootstrap.Modal(document.getElementById('dailyAssistantModal'));
    modal.show();
}

function handleSubstitution() {
    alert('🔄 Funcionalidade em desenvolvimento!\n\nEm breve você poderá:\n• Informar ingredientes disponíveis\n• Receber sugestões de substituições\n• Verificar compatibilidade nutricional\n• Ajustar quantidades automaticamente');
    bootstrap.Modal.getInstance(document.getElementById('dailyAssistantModal')).hide();
}

function analyzeMenu() {
    alert('🍽️ Funcionalidade em desenvolvimento!\n\nEm breve você poderá:\n• Enviar foto do cardápio\n• Receber análise das opções\n• Ver pratos compatíveis com sua dieta\n• Sugestões de combinações saudáveis');
    bootstrap.Modal.getInstance(document.getElementById('dailyAssistantModal')).hide();
}

function generateShoppingList() {
    alert('🛒 Funcionalidade em desenvolvimento!\n\nEm breve você poderá:\n• Gerar lista baseada na sua dieta\n• Sugestões de produtos alternativos\n• Estimativa de preços\n• Organização por categoria');
    bootstrap.Modal.getInstance(document.getElementById('dailyAssistantModal')).hide();
}

function findRecipes() {
    alert('📚 Funcionalidade em desenvolvimento!\n\nEm breve você poderá:\n• Buscar receitas personalizadas\n• Filtrar por ingredientes disponíveis\n• Ajustar porções automaticamente\n• Calcular valores nutricionais');
    bootstrap.Modal.getInstance(document.getElementById('dailyAssistantModal')).hide();
}

// Add hover effects
document.addEventListener('DOMContentLoaded', function() {
    const hoverCards = document.querySelectorAll('.hover-card');
    const hoverCardsSmall = document.querySelectorAll('.hover-card-small');
    
    hoverCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
            this.style.transition = 'all 0.3s ease';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '';
        });
    });
    
    hoverCardsSmall.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 4px 15px rgba(0,0,0,0.1)';
            this.style.transition = 'all 0.3s ease';
            this.style.cursor = 'pointer';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '';
        });
    });
});
</script>
{% endblock %}
